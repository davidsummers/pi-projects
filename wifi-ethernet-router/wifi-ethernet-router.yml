# This ANSIBLE playbook sets up the Raspberry PI to make the WIFI the main
# internet connection and then to activate the ethernet connection and share
# the main WIFI connection with any devices connected to the ethernet port.

---

  - name: WIFI-ETHERNET router
    hosts: localhost
    become: yes
    tasks:

      - name: Install needed packages
        apt:
          name: "{{ item }}"
          state: present
        loop:
          - dnsmasq
          - radvd
          - tcpdump

      - name: Created needed directories.
        file:
          path: /etc/dhcp/dhclient-exit-hooks.d
          state: directory

      - name: Set up configuration files.
        copy:
          src: "./{{ item }}"
          dest: "/{{ item }}"
          owner: root
          group: root
          mode: u=rw,g=r
        loop:
          - etc/dhcp/dhclient-exit-hooks.d/prefix_delegation
          - etc/dhcpcd.conf
          - etc/dnsmasq.conf
          - etc/iptables.conf
          - etc/radvd.conf
          - etc/rc.local
          - etc/network/interfaces
          - etc/sysctl.conf

      - name: Start needed services.
        service:
          name: "{{ item }}"
          enabled: yes
          state: started
        loop:
          - dnsmasq
          - radvd
